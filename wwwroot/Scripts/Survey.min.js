function getCountries(n,t){function i(i){currentLat=i.coords.latitude;currentLong=i.coords.longitude;getQuestions(n,t)}function r(n){switch(n.code){case n.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case n.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case n.TIMEOUT:console.log("The request to get user location timed out.");break;case n.UNKNOWN_ERROR:console.log("An unknown error occurred.")}}localStorage.SurveyResponseData!=null?navigator.geolocation&&navigator.geolocation.getCurrentPosition(i,r):getQuestions(n,t)}function getQuestions(n,t){$.ajax({url:surveyUrl,type:"GET",data:{id:t},dataType:"Json",success:function(i){var e="",u,r,f,o;$.each(i,function(i,r){$("#"+n).html('<div class="survey-title-research">Please provide feedback for Participatory monitoring of SDGs<\/div><div id="cont_'+n+'" class="survey-cont"> <h4 class="survey-title">'+r.Title+"<\/h4><\/div>");r.opt.forEach(function(i,u){$("#cont_"+n).append('<div class="option-item"><input type="radio" id="'+(u+1)+'" name="'+r.Id+'" data-survey="'+t+'" title="'+i+'" class="surveyRadio"><label for="'+(u+1)+'"  class="option-label">'+i+"<\/label><\/div>");e=r.Id})});u=[];r=!1;localStorage.SurveyResponseData!=null&&(u=JSON.parse(localStorage.SurveyResponseData),f=u.filter(function(n){return n.id==e}),f.length>0&&($.each(f,function(n,t){t.lat>=currentLat-.05&&t.lat<=currentLat+.05&&t.lon>=currentLong-.05&&t.lon<=currentLong+.05&&(r=!0)}),r===!0&&getQuestions(n,t)));r===!1&&(o='<input type="hidden" id="imageUrl"/><div class="progress" progress_id="img_'+t+'" style="height:3px;margin-bottom:5px;display:none;"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:0%;"><\/div><\/div><label class="res-label" for="image-attachment">Image Attachment<\/label><input type="file" id="image-attachment" att_id="img_'+t+'" class="response_attachment" data-ext="imageUrl" accept="image/*"><input type="hidden" id="audioUrl"/><div class="progress" progress_id="aud_'+t+'" style="height:3px;margin-bottom:5px;display:none;"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:0%;"><\/div><\/div><label class="res-label" for="audio-attachment">Audio Attachment<\/label><input type="file" id="audio-attachment" att_id="aud_'+t+'" class="response_attachment" data-ext="audioUrl" accept="audio/*"><input type="hidden" id="videoUrl"/><div class="progress" progress_id="vid_'+t+'" style="height:3px;margin-bottom:5px;display:none;"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width:0%;"><\/div><\/div><label class="res-label" for="video-attachment">Video Attachment<\/label><input type="file" id="video-attachment" att_id="vid_'+t+'" class="response_attachment" data-ext="videoUrl" accept="video/*"><button type="button" class="btn btn-primary m-t-10" id="SubmitBtn" style="display:none;">Submit<\/button>',$("#cont_"+n).append(o),$(".survey-main").show(),setTimeout(function(){$(".survey-main").addClass("in-active")},1500))},error:function(){}})}function getLocation(){function n(n){var t="https://maps.googleapis.com/maps/api/geocode/json?latlng="+n.coords.latitude+"%2C"+n.coords.longitude+"&language=en&key=AIzaSyCeQCMZAeIW-9-dX1wVbNbSOWZpwn31HNs";$.getJSON(t).done(function(t){var u=$(".surveyRadio:checked").attr("data-survey"),r=[],f,i;localStorage.SurveyResponseData!=null&&(r=JSON.parse(localStorage.SurveyResponseData));f=new surveyResponseLocation(u,n.coords.latitude,n.coords.longitude);r.push(f);i="";t.results.length!=0&&(i=t.results[0].formatted_address);console.log("locAddress",i);localStorage.SurveyResponseData=JSON.stringify(r);SubmitSurvey(u,n.coords.latitude+","+n.coords.longitude,i,$(".surveyRadio:checked").attr("name"),$(".surveyRadio:checked").attr("title"),$("#imageUrl").val(),$("#audioUrl").val(),$("#videoUrl").val())})}function t(n){switch(n.code){case n.PERMISSION_DENIED:console.log("User denied the request for Geolocation.");break;case n.POSITION_UNAVAILABLE:console.log("Location information is unavailable.");break;case n.TIMEOUT:console.log("The request to get user location timed out.");break;case n.UNKNOWN_ERROR:console.log("An unknown error occurred.")}}navigator.geolocation?navigator.geolocation.getCurrentPosition(n,t):console.log("Geolocation is not supported by this browser.")}function SubmitSurvey(n,t,i,r,u,f,e,o){$.ajax({url:surveySubmitUrl,type:"Post",data:{SurveyId:n,location:t,locationTitle:i,scId:r,value:u,imgUrl:f,audUrl:e,vidUrl:o},dataType:"Json",success:function(n){console.log("here",n);$("#survey").html('<h3 class="text-center no-margin" style="color:#ff6a00;"><span style="font-size: 2em;line-height: 1em;">â˜º<\/span> Thanks<\/h3><p class="text-center">To View response on map <a href="/Research#lms" target="_blank">click here<\/a><\/p>')},error:function(){console.log("error",res.responseText)}})}var surveyUrl="https://ideame.azurewebsites.net/Survey/GetSingleQuestion",surveySubmitUrl="https://ideame.azurewebsites.net/Survey/SubmitResearchSurvey",currentLat=0,currentLong=0,surveyResponseLocation;$(document).on("change",".response_attachment",function(){var t,u,n;if(window.FormData!==undefined){var f=$(this).get(0),i=f.files,r=new FormData;for(t=0;t<i.length;t++)r.append(i[t].name,i[t]);u=$(this).data("ext");n=$(this).attr("att_id");r.append("att_id",$(this).attr("att_id"));$.ajax({url:"https://ideame.azurewebsites.net/SurveyBuilder/UploadAttachmentForWeb",type:"POST",xhr:function(){var t=$.ajaxSettings.xhr();return $('div[progress_id="'+n+'"] .progress-bar').css({width:"0"}),t.upload&&(t.upload.addEventListener("progress",e,!1),$('div[progress_id="'+n+'"]').show()),t},contentType:!1,processData:!1,data:r,success:function(n){n=="Error"?alert("Something went wrong!"):$("#"+u).val(n.value)},error:function(){}});function e(t){if(t.lengthComputable){var r=t.total,u=t.loaded,i=u*100/r;i=parseInt(i);$('div[progress_id="'+n+'"] .progress-bar').css({width:i+"%"});i>=100&&($('div[progress_id="'+n+'"]').hide(),$('label[for="'+n+'_id"] .status').html('<span class="fa fa-check"><\/span>'))}}}});$(document).on("change",".surveyRadio",function(){$("#SubmitBtn").show()});$(document).on("click","#SubmitBtn",getLocation);surveyResponseLocation=function(n,t,i){this.id=n;this.lat=t;this.lon=i};