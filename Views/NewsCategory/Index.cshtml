@model Devdiscourse.Models.BasicModels.Category
@{
    ViewBag.Title = Model.PageTitle;
    //ViewBag.Title = "Agroforestory News : Latest Technology Development and Updates | DevDiscourse";
    string domainUrl = "https://www.devdiscourse.com";
    //string imageUrl = Model.BannerImage;
    string imageUrl = "/AdminFiles/logo/devdiscourse_logo.svg";
    ViewBag.PageDescription = Model.PageDescription;
    //ViewBag.PageDescription = "International Development News, Breaking News, Technology News, Business News, Sports News, Science News, Entertainment News and Political News";
    ViewBag.webEdition = ViewBag.region;
    ViewBag.PostUrl = "https://www.devdiscourse.com/" + @Model.Slug;
    // ViewBag.PostUrl = "https://www.devdiscourse.com/" + "technologyreasearch";
    ViewBag.pageKeywords = Model.Keywords;
    //ViewBag.pageKeywords = "About Us, International Development News, Devdiscourse";
    var newsImage = imageUrl.IndexOf("devdiscourse.blob.core.windows.net") != -1 ? imageUrl : string.Concat(domainUrl, imageUrl);
    ViewBag.PageImage = Model.PageImage;
    // ViewBag.PageImage = string.Concat(domainUrl, imageUrl);
}
<style>
    .renderBody {
        margin: 0;
    }

    .breadcrumb_new > li + li:before {
        color: #fff;
    }

    .sector-head {
        border-top: 1px solid #d9d9d9;
    }

    .isDisabled {
        color: #222;
        cursor: not-allowed;
        opacity: 0.8;
        text-decoration: none;
        pointer-events: none;
    }

    .parallex-cont {
        background-color: #474747;
        height: 150px;
        position: relative;
        background-position: top;
        background-attachment: fixed;
    }

    .m-p-img {
        padding-bottom: 56%;
        background-color: #eee;
        background-size: cover;
    }

    .no-border-radius {
        border-radius: 0;
    }

    .top-overlay {
        position: absolute;
        bottom: 0;
        background: linear-gradient(rgba(0,0,0,0),rgba(0,0,0,0.3),rgba(0,0,0,.6),rgba(0,0,0,.8));
        padding: 30px 10px 10px 10px;
        width: 100%;
    }

    .top-title {
        font-size: 22px;
        margin: 1px 0 0 0;
        color: #fff;
    }

    .t-s-img {
        padding-bottom: 60%;
        position: relative;
        background-size: cover;
    }

    .t-s-item {
        border-bottom: 1px solid #ccc;
        padding-bottom: 10px;
        margin-bottom: 10px;
    }

    .f-25 {
        font-size: 25px;
    }

    .sector-badge {
        font-weight: 400;
        background-color: #ff7b00;
        color: #fff;
        border-radius: 0;
    }

    .time-badge {
        padding: 3px 7px;
        font-size: 12px;
    }

    .infocus-badge {
        padding: 3px 5px;
        margin-top: 5px;
        font-size: 12px;
        background-color: #ff7b00;
        color: #fff;
    }

    .media-heading {
        font-weight: 400;
    }

    .news-list-div {
        border-bottom: 1px solid #ddd;
        height: 100px;
    }

        .news-list-div .media h4 {
            font-size: 17px;
        }

    .label.label-primary {
        background-color: red;
        font-weight: 400;
        font-family: monospace;
        font-size: 80%;
    }

    .frame-ad {
        width: 100%;
        height: 90px;
    }

    .cover-img {
        padding-bottom: 54%;
        position: relative;
        background-size: cover;
    }

    .cover-img-overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.2)
    }

    .text-cont {
        position: absolute;
        bottom: 0;
        padding: 20px;
    }

    .title-main {
        font-weight: 500;
        font-size: 36px;
    }

    .country-main {
        float: right;
        font-family: sans-serif;
        background-color: #ff7b00;
        color: #fff;
        padding: 8px 24px;
    }

    .title-sub {
        font-weight: 500;
        margin-top: 5px;
        line-height: 1.38;
        font-size: 20px
    }

    .country-sub {
        display: inline-block;
        font-family: sans-serif;
        z-index: 10;
        background-color: #ff7b00;
        color: #fff;
        padding: 2px 7px;
        font-size: 10px;
        margin-top: 5px
    }

    .news-media-card .media-title, .media-title {
        font-size: 18px;
        line-height: 1.38;
    }

    .l-h {
        line-height: 1.39;
    }

    .p-l-0 {
        padding-left: 0;
    }

    @@media(max-width:1440px) {
        .news-list-div {
            height: 120px;
        }
    }

    @@media(max-width:768px) {
        .news-list-div {
            height: 105px;
        }

        .title-sub {
            line-height: 1.28;
        }

        .country-main {
            padding: 2px 10px;
        }
    }

    @@media(max-width:425px) {
        .news-list-div {
            height: auto;
        }

        .frame-ad {
            max-width: 320px;
            height: 50px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .p-l-0 {
            padding-left: 15px;
        }

        .title-main {
            font-weight: 500;
            font-size: 24px;
        }

        .text-cont {
            padding: 10px;
        }
    }
</style>
<div class="bg-highlight">
    <img src="~/Content/transparent.png" data-src="@Model.BannerImage" class="img-responsive lazy center-block" />
</div>
<div class="container p-t-40">
    <h2 class="section-title"><span>@Model.Title TOP STORIES</span></h2>
    @{
        // Html.RenderAction("GetSectorTopStories", "NewsCategory", new { category = Model.Id });
        // @await Component.InvokeAsync("CategoryTopStories",new { category=Model.Id });
    }
</div>
<div class="container m-t-10">
    <div class="row m-t-10">
        <div class="col-xs-12 col-md-8">
            <div class="clearfix m-t-20">
                <h2 class="section-title m-t-30"><span> Latest News</span></h2>
                <div class="row" id="newsContainer">
                    @{
                        // Html.RenderAction("CategoryNews", "NewsCategory", new { category = Model.Id });
                        @await Component.InvokeAsync("CategoryNews",new { category = Model.Id })
                        ;
                    }
                </div>
            </div>
            <div id="loading" style="display:none;">
                <p class="text-center"><span class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></span> Loading... </p>
            </div>
        </div>
        <div class="col-xs-12 col-md-4">
            <div class="clearfix" id="opinion"></div>
            <div class="clearfix m-t-30">
                <h2 class="section-title">
                    <span>TRENDING</span>
                </h2>
                @{
                    // Html.RenderAction("GetTrends", "Home", new { filter = "Trends", reg = ViewBag.region });
                    @await Component.InvokeAsync("Trends",new { filter= "Trends", reg = ViewBag.region })
                    ;
                }
            </div>
            <div class="clearfix m-t-20 m-b-20">
                <a href="https://play.google.com/store/apps/details?id=com.visionri.devdiscourse" rel="noreferrer" target="_blank"><img data-src="/images/admin/devdiscourse_banner.jpg?format=jpeg" src="~/Content/transparent.png" class="img-responsive center-block lazy" alt="Download the Devdiscourse App" /></a>
            </div>
            <div class="clearfix m-t-30" id="videoNews"></div>
        </div>
    </div>
</div>
@section scripts{
    <script>
        $(document).ready(function () {
            var region = '@(ViewBag.region)';
            var _id = '@(Model.Id)';
            var page = 1;
            var inCallback = false;
            var showMoreCounter = 0;
            var isReachedScrollEnd = false;
            var monthArray = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            $(document).find('.linkBtn').removeClass('active');
            $(document).find('#newsLink').addClass('active');
            $(document).find('#regDropDown').change(function () {
                var date = new Date();
                date.setTime(date.getTime() + (24 * 60 * 60 * 1000));
                document.cookie = "Edition=" + $(this).val() + ";expires=" + date.toGMTString() + "; path=/";
                window.location.href = $(this).find('option:selected').attr('data-to');
            });
            $(window).scroll(function () {
                if (isReachedScrollEnd == false && ($(document).scrollTop() <= $(document).height() - $(window).height()) && showMoreCounter < 5) {
                    loadNewsData();
                }
            });
            $.ajax("/Home/GetVideoNews?reg=" + '@(ViewBag.region)').done(function (data) {
                $("#videoNews").html(data);
                $('.lazy').lazy();
            });
            function convertToSlug(newsId, str) {
                str = str.replace(/^\s+|\s+$/g, '');
                str = str.toLowerCase();
                var from = "àáäâèéëêìíïîòóöôùúüûñç·/_,:;";
                var to = "aaaaeeeeiiiioooouuuunc------";
                for (var i = 0, l = from.length; i < l; i++) {
                    str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i));
                }
                str = str.replace(/[^a-z0-9 -]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-');
                return newsId + "-" + str;
            }
            function loadNewsData() {
                if (page > -1 && !inCallback) {
                    inCallback = true;
                    page++;
                    $("#loading").show();
                    $.ajax({
                        type: 'GET',
                        url: '/api/Search/CategoryNews/' + _id + '/' + page,
                        dataType: "json",
                        success: function (data) {
                            showMoreCounter = showMoreCounter + 1;
                            if (data.length == 0) {
                                isReachedScrollEnd == true;
                                $("#loading").hide();
                                return;
                            }
                            var html = '';
                            $.each(data, function (i, item) {
                                var imageContent = '';
                                var urlSlug = convertToSlug(item.NewId, item.Title);
                                var label = item.Label != null ? item.Label : "agency-wire";
                                var country = item.Country != null ? item.Country : '';
                                var newsImage = '/images/sector/all_sectors.jpg';
                                if (item.ImageUrl != null && item.ImageUrl != "/images/defaultImage.jpg" && item.ImageUrl != "/images/newstheme.jpg" && item.ImageUrl != "/images/sector/all_sectors.jpg") {
                                    newsImage = item.ImageUrl.indexOf("devdiscourse.blob.core.windows.net") != -1 ? "/remote.axd?" + item.ImageUrl : item.ImageUrl;
                                }
                                var createdOn = new Date(item.CreatedOn);
                                createdOn.setMinutes(createdOn.getMinutes() - (new Date).getTimezoneOffset());
                                var countryHtml = 'Global';
                                if (country.split(',').length > 0 && country != '') {
                                    countryHtml = country.split(',')[0];
                                }
                                html += '<a href="/article/' + label + '/' + urlSlug + '" class="text-decoration">' +
                                    '<div class="m-b-30 col-md-12">' +
                                    '<div class="row">' +
                                    '<div class="col-md-5 col-sm-4">' +
                                    '<div class="bg-gray cover-img lazy" data-src="https://www.devdiscourse.com' + newsImage + '?width=295&height=160&mode=crop&anchor=top&format=jpeg"></div>' +
                                    '</div>' +
                                    '<div class="col-md-7 col-sm-8 p-l-0">' +
                                    '<div class="text-uppercase country-sub">' + countryHtml + '</div>' +
                                    '<h3 class="title-sub">' + item.Title + '</h3>' +
                                    '<h5 class="no-margin font-oswald fg-black">' + createdOn.getDate() + ' ' + monthArray[createdOn.getMonth()] + ' ' + createdOn.getFullYear() + '</h5>' +
                                    '</div>' +
                                    '</div>' +
                                    '</div>' +
                                    '</a>';
                                //html += '<div class="m-b-10 col-xs-12 col-sm-6">'+
                                //    '<div style="border-bottom: 1px solid #ddd;height:100px;">'+
                                //        '<div class="media">'+imageContent+
                                //            '<div class="media-body">'+
                                //                '<a href="/article/'+label+'/'+urlSlug+'" class="text-decoration">'+
                                //                    '<h4 class="media-heading" title="'+item.Title+'">'+item.Title+
                                //                    '</h4></a>'+
                                //                '<p class="one-line-text text-muted">'+
                                //    countryHtml+'<span>'+createdOn.getDate()+' '+monthArray[createdOn.getMonth()]+' '+createdOn.getFullYear()+'</span>'+
                                //                '</p></div></div></div></div>';
                            })

                            inCallback = false;
                            $("#newsContainer").append(html);
                            $('.lazy').lazy();
                            if (showMoreCounter == 5) {
                                $("#newsContainer").append('<div class="col-xs-12"><div style="padding:10px;border:1px solid #eee;" class="loadMoreButton m-t-10 m-b-10 text-center">SHOW MORE <span class="fa fa-chevron-circle-down" aria-hidden="true"></span></div></div>');
                            }
                            $("#loading").hide();
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                        }
                    });
                }
            }
            $(document).on("click", ".loadMoreButton", function () {
                $(this).remove();
                showMoreCounter = 0;
                loadNewsData();
            });
        });
    </script>
}
